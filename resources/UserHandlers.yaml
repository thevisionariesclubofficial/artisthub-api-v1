functions:
  createUser:
    handler: src/handlers/user.createUser
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:PutItem
        - dynamodb:Query
      Resource: 
        - !GetAtt UsersTable.Arn
        - !Sub '${UsersTable.Arn}/index/usernameIndex'
  events:
    - httpApi:
        path: /users
        method: post
        cors: true
        authorizer: jwtAuthorizer

getUserById:
  handler: src/handlers/user.getUserById
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:GetItem
      Resource: !GetAtt UsersTable.Arn
  events:
    - httpApi:
        path: /users/{userId}
        method: get
        cors: true
        authorizer: jwtAuthorizer

getUserByUsername:
  handler: src/handlers/user.getUserByUsername
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:Query
      Resource:
        - !GetAtt UsersTable.Arn
        - !Sub '${UsersTable.Arn}/index/usernameIndex'
  events:
    - httpApi:
        path: /users/username/{username}
        method: get
        cors: true
        authorizer: jwtAuthorizer

updateUser:
  handler: src/handlers/user.updateUser
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:UpdateItem
        - dynamodb:GetItem
        - dynamodb:Query
      Resource:
        - !GetAtt UsersTable.Arn
        - !Sub '${UsersTable.Arn}/index/usernameIndex'
  events:
    - httpApi:
        path: /users/{userId}
        method: put
        cors: true
        authorizer: jwtAuthorizer

deleteUser:
  handler: src/handlers/user.deleteUser
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:DeleteItem
        - dynamodb:GetItem
      Resource: !GetAtt UsersTable.Arn
  events:
    - httpApi:
        path: /users/{userId}
        method: delete
        cors: true
        authorizer: jwtAuthorizer

listUsers:
  handler: src/handlers/user.listUsers
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:Scan
      Resource: !GetAtt UsersTable.Arn
  events:
    - httpApi:
        path: /users
        method: get
        cors: true
        authorizer: jwtAuthorizer

incrementUserView:
  handler: src/handlers/user.incrementUserView
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:UpdateItem
      Resource: !GetAtt UsersTable.Arn
  events:
    - httpApi:
        path: /users/{userId}/view
        method: put
        cors: true
        authorizer: jwtAuthorizer

addWorkExperience:
  handler: src/handlers/user.addWorkExperience
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:UpdateItem
        - dynamodb:GetItem
      Resource: !GetAtt UsersTable.Arn
  events:
    - httpApi:
        path: /users/{userId}/work-experience
        method: post
        cors: true
        authorizer: jwtAuthorizer

addPortfolioItem:
  handler: src/handlers/user.addPortfolioItem
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:UpdateItem
        - dynamodb:GetItem
      Resource: !GetAtt UsersTable.Arn
  events:
    - httpApi:
        path: /users/{userId}/portfolio
        method: post
        cors: true
        authorizer: jwtAuthorizer

addConnection:
  handler: src/handlers/user.addConnection
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:UpdateItem
        - dynamodb:GetItem
      Resource: !GetAtt UsersTable.Arn
  events:
    - httpApi:
        path: /users/{userId}/connections
        method: post
        cors: true
        authorizer: jwtAuthorizer

searchUsers:
  handler: src/handlers/user.searchUsers
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:Scan
      Resource: !GetAtt UsersTable.Arn
  events:
    - httpApi:
        path: /users/search
        method: get
        cors: true
        authorizer: jwtAuthorizer
